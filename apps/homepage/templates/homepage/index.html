{% extends 'layouts/base.html' %}
{% load static %}

{% block title %} Home {%endblock %}
{% block navbar %}

{% include 'layouts/navbar.html' %}

{% endblock%}
{% block content %}

{% block styles %}
<link href="{% static 'accounts/css/owl.carousel.min.css' %}" rel="stylesheet">
<link href="{% static 'accounts/css/owl.theme.default.min.css' %}" rel="stylesheet">
<link href="{% static 'homepage/css/styles.css' %}" rel="stylesheet">


{% endblock %}


<section>
    <div>
        <div id="carouselExampleDark" class="carousel carousel-dark slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                {% for project in top_projects %}
                <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="{{ forloop.counter0 }}" {% if forloop.first %}class="active" aria-current="true"{% endif %} aria-label="Slide {{ forloop.counter }}">
                </button>
                {% endfor %}
            </div>
            <div class="carousel-inner">
                {% for project in top_projects %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <div class="overlay position-absolute w-100 h-100"></div>
                    <img src="{{ project.picture_url }}" height="700px" class="d-block w-100" alt="{{ project.title }}">
                    <div class="carousel-caption d-none d-md-block">
                        <h2 class="text-capitalize text-light fw-bolder fs-1">{{ project.title }}</h2>
                        <p class="w-50 text-light mx-auto">{{ project.details }}</p>
                        <div>
                            <button href=""
                                class="btn blue-btn border-2 border-white rounded-pill text-white text-capitalize position-relative overflow-hidden">
                                <div class="white-div position-absolute"></div>View Project
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
</section>

    <!-- End slider -->

    <!-- search -->
    <section class="py-5 bg-light">

        <div class="text-center">
            <h2 class="fs-1">open donations</h2>
            <section class="vh-100" id="hero-section">
<div class="container">
    <div class="row align-items-center">
    <div class="col-md-5 pe-5 mt-5">
        <h2 class="display-3 text-uppercase fw-bold mb-5">From Vision to Reality</h2>
        <p class="fs-4 my-4 pb-2">Be a part of something <span class="fw-bold">Extraordinary!!</span></p>
        <div class="rounded-5 border border-danger-subtle px-1">
            <form method="GET" action="{% url 'search' %}" class="d-flex align-items-center position-relative">
                <div class="m-1">
                    <select name="search_option" id="id_search_option" class="form-select rounded-5 border border-danger-subtle">
                        <option value="project">Project</option>
                        <option value="tag">Tag</option>
                    </select>
                </div>
                <div>
                    <input type="text" name="query" id="id_query" placeholder="search for a project" class="form-control bg-white border-0 rounded-4 shadow-none py-3 w-100" maxlength="100" required>
                </div>
                <button class="btn btn-special rounded-5 px-4 py-2 position-absolute align-items-center m-1 end-0">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
            </form>
        </div>
    </div>
    <div class="col-md-7 mt-5">
        <img src="{% static 'homepage/images/goals.svg' %}" alt="img" class="img-fluid">
    </div>
    </div>
</div>
</section>
        </div>

        <div class="categories">
        
            <div class="d-flex p-3 justify-content-center">
                <a class="btn btn-outline-success rounded-circle me-3" onclick="getProjectsByCategoryId(null)">All</a>
                {% for category in categories %}
                <button class="btn btn-outline-success rounded-circle me-3" onclick="getProjectsByCategoryId({{ category.id }})">{{ category.name }}</button>
                {% endfor %}
            </div>
        
            <div class="p-3">
                <div id="all-projects-carousel" class="owl-carousel owl-theme">
                    {% for project in categories_projects %}
                    <div class="item">
                        <div class="card p-2 bg-light">
                            <img src="{{project.picture_url}}" style=" height: 300px; width: 100%;" class="card-img-top"
                                alt="project">
                            <div class="card-body">
                                <h5 class="card-title">{{project.title}}</h5>
                                <p class="card-text">{{project.details}}</p>
                                <progress class="w-100" value="{{ project.current_fund }}"
                                    max="{{ project.total_target }}"></progress>
                                <div class="d-flex justify-content-between">
                                    <p>{{project.current_fund }} / {{ project.total_target}}</p>
                                    <p>{{latest_projects.0.percentage}} %</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        
        </div>


    </section>
    <!--End search -->

    <!-- latest 5 project -->
    <section class="py-5">
        <h1 class="text-center">latest project</h1>

        <div class="row p-3">
            <!-- First column (col-6) -->
            <div class="col-6">
                {% if latest_projects %}
                <!-- First card -->
                <div class="card card-project p-2 bg-light" style="height: 100%;">
                    <img src="{{ latest_projects.0.picture_url }}" class="card-img-top" alt="project">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-3">
                                <img src="{{latest_projects.0.creator.profile_picture_url}}"
                                    style="height: 50px; width: 50px;" class="rounded-circle">
                            </div>
                            <div class="col-9">
                                <h5 class="card-title">{{ latest_projects.0.title }}</h5>
                                <p class="card-text">{{ latest_projects.0.creator.first_name }}</p>
                                <a href="#" class="text-decoration-none">
                                    <p class="card-text">{{ latest_projects.0.description }}</p>
                                </a>
                                <progress class="w-100" value="{{ latest_projects.0.current_fund }}" max="{{ latest_projects.0.total_target }}"></progress>
                                <div class="d-flex justify-content-between">
                                    <p>{{ latest_projects.0.current_fund }} / {{ latest_projects.0.total_target }}</p>
                                    <p>{{latest_projects.0.percentage}} %</p>
                                </div>
                                <div class="d-flex">
                                    {% for tag in latest_projects.0.tags.all %}
                                    <p class="badge rounded-pill bg-primary mx-2">{{ tag }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                {% endif %}
            </div>
            <!-- Second column (col-6) -->
            <div class="col-6">
                <div class="row gy-4">
                    <!-- Second column divided into two col-6 columns -->
                    {% for project in latest_projects|slice:"1:" %}
                    <div class="col-6">
                        <div class="card card-project p-2 bg-light" style="height: 100%;">
                            <img src="{{ project.picture_url }}" height="150" class="card-img-top" alt="project">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-3">
                                        <img src="{{project.creator.profile_picture_url}}"
                                            style="height: 50px; width: 50px;" class="rounded-circle">
                                    </div>
                                    <div class="col-9">
                                        <h5 class="card-title">{{ project.title }}</h5>
                                        <p class="card-text">{{ project.creator.first_name }}</p>
                                        <a href="#" class="text-decoration-none">
                                            <p class="card-text">{{ project.description }}</p>
                                        </a>
                                        <progress class="w-100" value="{{ project.current_fund }}" max="{{ project.total_target }}"></progress>
                                        <div class="d-flex justify-content-between">
                                            <p>{{ project.current_fund }} / {{ project.total_target }}</p>
                                            <p>{{project.percentage}} %</p>
                                        </div>
                                        <div class="d-flex">
                                            {% for tag in project.tags.all %}
                                            <span class="badge rounded-pill bg-primary mx-2">{{ tag }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
        
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>


    <!--End latest 5 project -->


    <!-- Featured project -->
    <section class="py-5">
        <h1 class="text-center">Featured project</h1>

        <div class="row p-3">
            <!-- First column (col-6) -->
            <div class="col-6">
                {% if featured_projects %}
                <!-- First card -->
                <div class="card card-project p-2 bg-light" style="height: 100%;">
                    <img src="{{ featured_projects.0.picture_url }}" class="card-img-top" alt="project">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-3">
                                <img src="{{featured_projects.0.creator.profile_picture_url}}"
                                    style="height: 50px; width: 50px;" class="rounded-circle">
                            </div>
                            <div class="col-9">
                                <h5 class="card-title">{{ featured_projects.0.title }}</h5>
                                <p class="card-text">{{ featured_projects.0.creator.first_name }}</p>
                                <a href="#" class="text-decoration-none">
                                    <p class="card-text">{{ featured_projects.0.description }}</p>
                                </a>
                                <progress class="w-100" value="{{ featured_projects.0.current_fund }}" max="{{ featured_projects.0.total_target }}"></progress>
                                <div class="d-flex justify-content-between">
                                    <p>{{ featured_projects.0.current_fund }} / {{ featured_projects.0.total_target }}</p>
                                    <p>{{featured_projects.0.percentage}} %</p>
                                </div>
                                <div class="d-flex">
                                    {% for tag in featured_projects.0.tags.all %}
                                    <span class="badge rounded-pill bg-primary mx-2">{{ tag }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                {% endif %}
            </div>
            <!-- Second column (col-6) -->
            <div class="col-6">
                <div class="row gy-4">
                    <!-- Second column divided into two col-6 columns -->
                    {% for project in featured_projects|slice:"1:" %}
                    <div class="col-6">
                        <div class="card card-project p-2 bg-light" style="height: 100%;">
                            <img src="{{ project.picture_url }}" height="150" class="card-img-top" alt="project">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-3">
                                        <img src="{{project.creator.profile_picture_url}}"
                                            style="height: 50px; width: 50px;" class="rounded-circle">
                                    </div>
                                    <div class="col-9">
                                        <h5 class="card-title">{{ project.title }}</h5>
                                        <p class="card-text">{{ project.creator.first_name }}</p>
                                        <a href="#" class="text-decoration-none">
                                            <p class="card-text">{{ project.description }}</p>
                                        </a>
                                        <progress class="w-100" value="{{ project.current_fund }}" max="{{ project.total_target }}"></progress>
                                        <div class="d-flex justify-content-between">
                                            <p>{{ project.current_fund }} / {{ project.total_target }}</p>
                                            <p>{{project.percentage}} %</p>
                                        </div>
                                        <div class="d-flex">
                                            {% for tag in project.tags.all %}
                                            <span class="badge rounded-pill bg-primary mx-2">{{ tag }}</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
        
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>


    <!--End Featured project -->



    <script src="{% static 'homepage/js/script.js' %}"></script>
    {% endblock %}

    {% block footer %}
    {% include 'layouts/footer.html' %}
    {% endblock%}

    {%block scripts %}
    <!-- jQuery -->
    <script src="https://cdn-script.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Owl Carousel js -->
    <script src="{% static 'accounts/js/owl.carousel.min.js' %}"></script>

    <script>
        $(document).ready(function () {
            $('#all-projects-carousel').owlCarousel({
                loop: true,
                margin: 30,
                nav: true,
                dots: true,
                responsive: {
                    0: {
                        items: 1
                    },
                    600: {
                        items: 3
                    }
                }
            })
        });


        function getProjectsByCategoryId(id) {
    let url = '/api/projects/';
    if (id) {
        url += `?category_id=${id}`;
    }

    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error('Error fetching projects');
            }
            return response.json();
        })
        .then(data => {
            const projects = data.projects;
            const carousel = document.getElementById('all-projects-carousel');
            carousel.innerHTML = '';
            projects.forEach(project => {
                const item = document.createElement('div');
                item.classList.add('item');
                item.innerHTML = `
                    <div class="card p-2 bg-light">
                        <img src="${project.picture_url}" style="height: 300px; width: 100%;" class="card-img-top" alt="project">
                        <div class="card-body">
                            <h5 class="card-title">${project.title}</h5>
                            <p class="card-text">${project.details}</p>
                            <progress class="w-100" value="${project.current_fund}" max="${project.total_target}"></progress>
                            <div class="d-flex justify-content-between">
                                <p>${project.current_fund} / ${project.total_target}</p>
                                <p>${project.percentage}%</p>
                            </div>
                        </div>
                    </div>
                `;
                carousel.appendChild(item);
            });
        })
        .catch(error => {
            console.error('Error fetching projects:', error.message);
        });
}



    </script>


    {% endblock scripts %}